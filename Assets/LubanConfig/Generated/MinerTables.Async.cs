//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by MinerTablesAsyncGenerator.
//     Changes to this file may be overwritten.
// </auto-generated>
//------------------------------------------------------------------------------

using System.Collections.Generic;
using Cysharp.Threading.Tasks;
using Luban;

namespace Miner.Config
{
    public partial class MinerTables
    {
        /// <summary>
        /// 异步创建配置表（热更模式）
        /// </summary>
        /// <param name="loader">异步加载函数，参数为不含后缀的表名</param>
        public static async UniTask<MinerTables> CreateAsync(System.Func<string, UniTask<ByteBuf>> loader)
        {
            var cache = new Dictionary<string, ByteBuf>();

            var fileNames = new[]
            {
                "tbhelloworld",
                "tbnihao",
                "tbsampledata",
            };

            foreach (var fileName in fileNames)
            {
                cache[fileName] = await loader(fileName);
            }

            return new MinerTables(fileName =>
            {
                if (cache.TryGetValue(fileName, out var buf))
                {
                    return buf;
                }
                return new ByteBuf(new byte[0]);
            });
        }
    }
}
